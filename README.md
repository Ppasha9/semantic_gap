# Задача семантического разрыва
Первая реализация задачи семантического разрыва

# Постановка задачи
Пусть дана фотография, сделанная с камеры. На фотографии изображен стул на фоне дверного проема. Требуется установить, пролезает ли данный стул через дверной проем, если его нести так как сфотографировано на изображении, то есть ответить "да" или "нет". Алгоритм должен выдавать точность на тестовых данных не менее 80 %.

Требования к съемке и к фотографиям:
1. точка съемки должна отстоять от дверного проема на расстоянии не менее 3ч метров.
2. фотография должен быть сделана прямо напротив дверного проема, чтобы его плоскость вертикальна - чтобы границы двери были прямыми и не сужались/расширялись к верхней/нижней границам фотографии
3. на фотографии отчетливо должны быть видны как стул, так и дверной проем
4. освещение должно быть светлое, но не засветленное, то есть должны быть отчетливо видны границы стула, дверного проема, и стул должен четко выделяться на фоне дверного проема
5. на фотографии не должны присутствовать посторонние предметы

Данные: фотографии, на которых изображен стул в различных положениях на фоне дверного проема.
Данные разделены на тестовые и тренировочные.

# Установка
1. Склонировать/скачать репозиторий на локальную машину.
2. В репозитории присутствует файл `requirements.txt`, который нужно использовать для создания виртуального окружения.
3. С помощью PyCharm открыть директорию репозитория как проект.
4. В настройках PyCharm: `File -> Settings -> Project Interpreter` добавить новый интерпретатор, тем самым создав виртуального окружение. Его можно также создать через команду `virtualenv` (подробнее можно почитать тут: https://python-scripts.com/virtualenv)
5. В созданном виртуальном окружении прописать команду `pip install -r requirements.txt`
6. Запустить файл `main.py` с параметрами, указанными в описании этого файла
7. Для запуска алгоритма на тестовый данных - `main.py --test`. Для запуска алгоритма на тренировочных данных - `main.py --train`.
8. Также присутствует опция `--verbose`, при указании которой в корневые директории проекта `./TRAIN_VERBOSE_OUTPUT` и `./TEST_VERBOSE_OUTPUT` будут сохраняться промежуточные резльутаты работы алгоритма для каждой фотографии из соответствующего датасета данных (тренировочный/тестовый).

# Что реализовано
Была реализована вторая итерация по улучшению алгоритма.
Изменения:
* Рефакторинг директории с датасетом (`DATA_PHOTOS`): теперь она содержит две поддиректории `test` и `train`, в каждой из которох лежат фотографии и файл `labels.json` с описанием меток фотографий.
* Была добавлена директория `TEMPLATES`, содержащая в себе шиблоны для поиска стула на фотографиях.
* Файл `main.ipynb` был удален. Весь исходный код был пересен в файлы `*.py`, разделен на модули и переписан.
* Теперь есть отдельный класс `algorithm.semantic_gap_solver.SemanticGapProblemSolver`, который представляет собой реализацию алгоритма решения задачи семантического разрыва.
* Были реализованый отдельные классы для нахождения ширины стула и ширины двери:
  * Класс `algorithm.chair._chair_width_calculator.ChairWidthCalculator`, подсчитывающий ширину стула на фотографии.
  * Класс `algorithm.door._door_width_calculator.DoorWidthCalculator`, подсчитывающий ширину двери на фотографии.
* Полученная точность работы алгоритма:
  * На тренировочных данных: `0.86`
  * На тестовый данных: `0.90`

# План решения
* Сначала на входной фотографии необходимо выделить стул и дверной проём.
* Ищем дверной проход.
  * Применяем алгоритм бинаризации `Sauvola`, который на выходе выдает результат, схожий с алгоритмом `Canny` для выделения границ. 
  * Применяем алгоритм Хафа на бинаризованной картинке - находим 2 близкие к вертикальным линии, которые находятся ближе к центру - именно такие, потому что у двери есть наличники, и алгоритм Хафа может найти по две прямые у каждой границы прохода.
  * Данные линии принимаем за контуры двери.
* Ищем стул.
  * Для этого используем ORB-детектор.
  * Заранее были заготовлены шаблоны стула в директории `TEMPLATES`.
  * Пробегаемся по всем шаблонам и находим самый лучший. Критерий отбора - максимальное число точек схожих особый точек, отстоящих друг от друга не более чем на заданное заранее расстояние (в результате тестирования было выбрано расстояние, равное `70`)
  * Тем самым находим контур стула.
* По найденным контурам находим ширину стула и дверного проема и сравниваем их.
* Выдаем ответ "да" или "нет".
   
# Планы на будущее
Улучшить алгоритм путем увеличения количества шаблонов, подкорректирования параметров ORB-детектора и алгоритма Хафа.
